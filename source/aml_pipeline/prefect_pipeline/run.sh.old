#!/bin/bash
# Manual runs for Prefect deployments (detached from deploy.sh)

ENRICH_DATE=$(date -d "yesterday" +%Y%m%d)
SCORE_DATE=$(date -d "2 days ago" +%Y%m%d)
LOG_DIR=/var/log/aml_pipeline
mkdir -p "$LOG_DIR"

prefect deployment run "Daily Enrichment/enrich-daily" --params "{\"date\": \"$ENRICH_DATE\"}" >> "$LOG_DIR/prefect-enrich-daily.log" 2>&1
prefect deployment run "Daily Scoring/score-daily" --params "{\"date\": \"$SCORE_DATE\"}" >> "$LOG_DIR/prefect-score-daily.log" 2>&1
prefect deployment run "Weekly Training/train-weekly" >> "$LOG_DIR/prefect-train-weekly.log" 2>&1
prefect deployment run "Drift Monitor/drift-monitor" >> "$LOG_DIR/prefect-drift-monitor.log" 2>&1
#prefect deployment run "Kafka Producer Flow/kafka-producer" >> "$LOG_DIR/prefect-kafka-producer.log" 2>&1
#prefect deployment run "Kafka Consumer Flow/kafka-consumer" >> "$LOG_DIR/prefect-kafka-consumer.log" 2>&1
prefect deployment run "Kafka Streaming Loop/kafka-loop" >> "$LOG_DIR/prefect-kafka-loop.log" 2>&1
